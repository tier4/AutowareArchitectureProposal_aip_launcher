<launch>
  <arg name="ars_version" default="$(env ARS_VERSION ars408)" description="ars408 or ars548" />


  <group if="$(eval &quot;'$(var ars_version)'=='ars408'&quot;)">
    <arg name="launch_driver" default="true" />
    <arg name="input/frame" default="from_can_bus" />
    <arg name="radar_can_device" default="canRadar" />

    <push-ros-namespace namespace="radar"/>

    <group>
      <push-ros-namespace namespace="front_center"/>

      <include file="$(find-pkg-share common_sensor_launch)/launch/ars408.launch.xml">
        <arg name="launch_driver" value="$(var launch_driver)" />
        <arg name="interface" value="$(var radar_can_device)" />
        <arg name="input/frame" value="$(var input/frame)" />
        <arg name="output_frame" value="ars408_front_center" />
      </include>
    </group>

    <node pkg="topic_tools" exec="relay" name="radar_relay" output="log" args="front_center/detected_objects detected_objects"/>

  </group>

  <group if="$(eval &quot;'$(var ars_version)'=='ars548'&quot;)">
    <let name="odometry_topic" value="/localization/kinematic_state"/>
    <let name="twist_topic" value="/sensing/vehicle_velocity_converter/twist_with_covariance"/>
    <let name="acceleration_topic" value="/localization/acceleration"/>
    <let name="steering_angle_topic" value="/vehicle/status/steering_status_scalar"/>
    <arg name="radar_tracks_msgs_converter_param_path" default="$(find-pkg-share common_sensor_launch)/config/radar_tracks_msgs_converter.param.yaml"/>
    <push-ros-namespace namespace="radar"/>

    <node pkg="topic_tools" exec="transform" name="steer_angle_transform" output="screen" args="/vehicle/status/steering_status /vehicle/status/steering_status_scalar std_msgs/msg/Float32 'std_msgs.msg.Float32(data=m.steering_tire_angle)'  --import autoware_auto_vehicle_msgs std_msgs --wait-for-start"/>
    <!-- ros2 run topic_tools transform /vehicle/status/steering_status /vehicle/status/steering_status_scalar std_msgs/msg/Float64 'std_msgs.msg.Float64(data=m.steering_tire_angle)'  \-\-import autoware_auto_vehicle_msgs std_msgs -->

    <group>
      <push-ros-namespace namespace="front_center"/>
      <group>
        <node pkg="nebula_ros" exec="continental_ars548_ros_wrapper_node" name="nebula_continental_ars548" output="screen">
          <param name="launch_hw" value="true"/>
          <remap from="/diagnostics" to="diagnostics"/>
          <remap from="odometry_input" to="$(var odometry_topic)"/>
          <remap from="acceleration_input" to="$(var acceleration_topic)"/>
          <remap from="steering_angle_input" to="$(var steering_angle_topic)"/>
          <param name="sensor_ip" value="10.13.1.114"/>
          <param name="frame_id" value="front_center/radar_link"/>
          <param name="object_frame" value="base_link"/>

          <param name="sensor_model" value="ARS548"/>
          <param name="host_ip" value="10.13.1.166"/>
          <param name="multicast_ip" value="224.0.2.2"/>
          <param name="data_port" value="42102"/>
          <param name="configuration_host_port" value="42401"/>
          <param name="configuration_sensor_port" value="42101"/>

          <param name="new_plug_orientation" value="0"/>
          <param name="base_frame" value="base_link" />
          <param name="object_frame" value="base_link" />
          <param name="use_sensor_time" value="false" />
          <param name="configuration_vehicle_length" value="4.89" />
          <param name="configuration_vehicle_width" value="1.896" />
          <param name="configuration_vehicle_height" value="2.5" />
          <param name="configuration_vehicle_wheelbase" value="2.79" />
        </node>
      </group>

      <group>
        <include file="$(find-pkg-share radar_tracks_msgs_converter)/launch/radar_tracks_msgs_converter.launch.xml">
          <arg name="input/radar_objects" value="objects_raw"/>
          <arg name="input/odometry" value="$(var odometry_topic)"/>
          <arg name="output/radar_detected_objects" value="detected_objects"/>
          <arg name="output/radar_tracked_objects" value="tracked_objects"/>
          <arg name="use_twist_compensation" value="false"/>
          <arg name="param_path" value="$(var radar_tracks_msgs_converter_param_path)"/>
        </include>
      </group>
    </group>

    <group>
      <push-ros-namespace namespace="front_left"/>
      <group>
                <node pkg="nebula_ros" exec="continental_ars548_ros_wrapper_node" name="nebula_continental_ars548" output="screen">


          <param name="launch_hw" value="true"/>
          <remap from="/diagnostics" to="diagnostics"/>
          <remap from="odometry_input" to="$(var odometry_topic)"/>
          <remap from="acceleration_input" to="$(var acceleration_topic)"/>
          <remap from="steering_angle_input" to="$(var steering_angle_topic)"/>

          <param name="sensor_ip" value="10.13.1.115"/>
          <param name="frame_id" value="front_left/radar_link"/>
          <param name="object_frame" value="front_left/radar_link"/>

          <param name="sensor_model" value="ARS548"/>
          <param name="host_ip" value="10.13.1.166"/>
          <param name="multicast_ip" value="224.0.2.2"/>
          <param name="data_port" value="42102"/>
          <param name="configuration_host_port" value="42401"/>
          <param name="configuration_sensor_port" value="42101"/>
          <param name="new_plug_orientation" value="0"/>
          <param name="base_frame" value="base_link" />
          <param name="object_frame" value="base_link" />
          <param name="use_sensor_time" value="false" />
          <param name="configuration_vehicle_length" value="4.89" />
          <param name="configuration_vehicle_width" value="1.896" />
          <param name="configuration_vehicle_height" value="2.5" />
          <param name="configuration_vehicle_wheelbase" value="2.79" />
          </node>
      </group>

      <group>
        <include file="$(find-pkg-share radar_tracks_msgs_converter)/launch/radar_tracks_msgs_converter.launch.xml">
          <arg name="input/radar_objects" value="objects_raw"/>
          <arg name="input/odometry" value="$(var odometry_topic)"/>
          <arg name="output/radar_detected_objects" value="detected_objects"/>
          <arg name="output/radar_tracked_objects" value="tracked_objects"/>
          <arg name="use_twist_compensation" value="false"/>
          <arg name="param_path" value="$(var radar_tracks_msgs_converter_param_path)"/>
        </include>
      </group>
    </group>

    <group>
      <push-ros-namespace namespace="front_right"/>
      <group>
                <node pkg="nebula_ros" exec="continental_ars548_ros_wrapper_node" name="nebula_continental_ars548" output="screen">
<param name="launch_hw" value="true"/>
          <remap from="/diagnostics" to="diagnostics"/>
          <remap from="odometry_input" to="$(var odometry_topic)"/>
          <remap from="acceleration_input" to="$(var acceleration_topic)"/>
          <remap from="steering_angle_input" to="$(var steering_angle_topic)"/>

          <param name="sensor_ip" value="10.13.1.116"/>
          <param name="frame_id" value="front_right/radar_link"/>
          <param name="object_frame" value="front_right/radar_link"/>

          <param name="sensor_model" value="ARS548"/>
          <param name="host_ip" value="10.13.1.166"/>
          <param name="multicast_ip" value="224.0.2.2"/>
          <param name="data_port" value="42102"/>
          <param name="configuration_host_port" value="42401"/>
          <param name="configuration_sensor_port" value="42101"/>
          <param name="new_plug_orientation" value="0"/>
          <param name="base_frame" value="base_link" />
          <param name="object_frame" value="base_link" />
          <param name="use_sensor_time" value="false" />
          <param name="configuration_vehicle_length" value="4.89" />
          <param name="configuration_vehicle_width" value="1.896" />
          <param name="configuration_vehicle_height" value="2.5" />
          <param name="configuration_vehicle_wheelbase" value="2.79" />
          </node>
      </group>

      <group>
        <include file="$(find-pkg-share radar_tracks_msgs_converter)/launch/radar_tracks_msgs_converter.launch.xml">
          <arg name="input/radar_objects" value="objects_raw"/>
          <arg name="input/odometry" value="$(var odometry_topic)"/>
          <arg name="output/radar_detected_objects" value="detected_objects"/>
          <arg name="output/radar_tracked_objects" value="tracked_objects"/>
          <arg name="use_twist_compensation" value="false"/>
          <arg name="param_path" value="$(var radar_tracks_msgs_converter_param_path)"/>
        </include>
      </group>
    </group>

    <group>
      <push-ros-namespace namespace="rear_center"/>
      <group>
                <node pkg="nebula_ros" exec="continental_ars548_ros_wrapper_node" name="nebula_continental_ars548" output="screen">


                    <param name="launch_hw" value="true"/>
          <remap from="/diagnostics" to="diagnostics"/>
          <remap from="odometry_input" to="$(var odometry_topic)"/>
          <remap from="acceleration_input" to="$(var acceleration_topic)"/>
          <remap from="steering_angle_input" to="$(var steering_angle_topic)"/>

          <param name="sensor_ip" value="10.13.1.117"/>
          <param name="frame_id" value="rear_center/radar_link"/>
          <param name="object_frame" value="base_link"/>

          <param name="sensor_model" value="ARS548"/>
          <param name="host_ip" value="10.13.1.166"/>
          <param name="multicast_ip" value="224.0.2.2"/>
          <param name="data_port" value="42102"/>
          <param name="configuration_host_port" value="42401"/>
          <param name="configuration_sensor_port" value="42101"/>
          <param name="new_plug_orientation" value="0"/>
          <param name="base_frame" value="base_link" />
          <param name="object_frame" value="base_link" />
          <param name="use_sensor_time" value="false" />
          <param name="configuration_vehicle_length" value="4.89" />
          <param name="configuration_vehicle_width" value="1.896" />
          <param name="configuration_vehicle_height" value="2.5" />
          <param name="configuration_vehicle_wheelbase" value="2.79" />
          </node>
      </group>

      <group>
        <include file="$(find-pkg-share radar_tracks_msgs_converter)/launch/radar_tracks_msgs_converter.launch.xml">
          <arg name="input/radar_objects" value="objects_raw"/>
          <arg name="input/odometry" value="$(var odometry_topic)"/>
          <arg name="output/radar_detected_objects" value="detected_objects"/>
          <arg name="output/radar_tracked_objects" value="tracked_objects"/>
          <arg name="use_twist_compensation" value="false"/>
          <arg name="param_path" value="$(var radar_tracks_msgs_converter_param_path)"/>
        </include>
      </group>
    </group>

    <group>
      <push-ros-namespace namespace="rear_left"/>
      <group>
                <node pkg="nebula_ros" exec="continental_ars548_ros_wrapper_node" name="nebula_continental_ars548" output="screen">


                    <param name="launch_hw" value="true"/>
          <remap from="/diagnostics" to="diagnostics"/>
          <remap from="odometry_input" to="$(var odometry_topic)"/>
          <remap from="acceleration_input" to="$(var acceleration_topic)"/>
          <remap from="steering_angle_input" to="$(var steering_angle_topic)"/>

          <param name="sensor_ip" value="10.13.1.118"/>
          <param name="frame_id" value="rear_left/radar_link"/>
          <param name="object_frame" value="base_link"/>

          <param name="sensor_model" value="ARS548"/>
          <param name="host_ip" value="10.13.1.166"/>
          <param name="multicast_ip" value="224.0.2.2"/>
          <param name="data_port" value="42102"/>
          <param name="configuration_host_port" value="42401"/>
          <param name="configuration_sensor_port" value="42101"/>
          <param name="new_plug_orientation" value="0"/>
          <param name="base_frame" value="base_link" />
          <param name="object_frame" value="base_link" />
          <param name="use_sensor_time" value="false" />
          <param name="configuration_vehicle_length" value="4.89" />
          <param name="configuration_vehicle_width" value="1.896" />
          <param name="configuration_vehicle_height" value="2.5" />
          <param name="configuration_vehicle_wheelbase" value="2.79" />
          </node>
      </group>
      <group>
        <include file="$(find-pkg-share radar_tracks_msgs_converter)/launch/radar_tracks_msgs_converter.launch.xml">
          <arg name="input/radar_objects" value="objects_raw"/>
          <arg name="input/odometry" value="$(var odometry_topic)"/>
          <arg name="output/radar_detected_objects" value="detected_objects"/>
          <arg name="output/radar_tracked_objects" value="tracked_objects"/>
          <arg name="use_twist_compensation" value="false"/>
          <arg name="param_path" value="$(var radar_tracks_msgs_converter_param_path)"/>
        </include>
      </group>
    </group>

    <group>
      <push-ros-namespace namespace="rear_right"/>
       <group>
                <node pkg="nebula_ros" exec="continental_ars548_ros_wrapper_node" name="nebula_continental_ars548" output="screen">


                   <param name="launch_hw" value="true"/>
          <remap from="/diagnostics" to="diagnostics"/>
          <remap from="odometry_input" to="$(var odometry_topic)"/>
          <remap from="acceleration_input" to="$(var acceleration_topic)"/>
          <remap from="steering_angle_input" to="$(var steering_angle_topic)"/>

          <param name="sensor_ip" value="10.13.1.119"/>
          <param name="frame_id" value="rear_right/radar_link"/>
          <param name="object_frame" value="base_link"/>

          <param name="sensor_model" value="ARS548"/>
          <param name="host_ip" value="10.13.1.166"/>
          <param name="multicast_ip" value="224.0.2.2"/>
          <param name="data_port" value="42102"/>
          <param name="configuration_host_port" value="42401"/>
          <param name="configuration_sensor_port" value="42101"/>
          <param name="new_plug_orientation" value="0"/>
          <param name="base_frame" value="base_link" />
          <param name="object_frame" value="base_link" />
          <param name="use_sensor_time" value="false" />
          <param name="configuration_vehicle_length" value="4.89" />
          <param name="configuration_vehicle_width" value="1.896" />
          <param name="configuration_vehicle_height" value="2.5" />
          <param name="configuration_vehicle_wheelbase" value="2.79" />
          </node>
      </group>

      <group>
        <include file="$(find-pkg-share radar_tracks_msgs_converter)/launch/radar_tracks_msgs_converter.launch.xml">
          <arg name="input/radar_objects" value="objects_raw"/>
          <arg name="input/odometry" value="$(var odometry_topic)"/>
          <arg name="output/radar_detected_objects" value="detected_objects"/>
          <arg name="output/radar_tracked_objects" value="tracked_objects"/>
          <arg name="param_path" value="$(var radar_tracks_msgs_converter_param_path)"/>
        </include>
      </group>
    </group>

    <!-- merge radar objects -->
    <let name="merger_param_path" value="$(find-pkg-share aip_xx1_gen2_launch)/config/radar_simple_object_merger.param.yaml"/>
    <node pkg="simple_object_merger" exec="simple_object_merger_node" name="simple_object_merger" output="screen">
      <remap from="~/output/objects" to="detected_objects"/>
      <param from="$(var merger_param_path)"/>
    </node>
  </group>

</launch>
